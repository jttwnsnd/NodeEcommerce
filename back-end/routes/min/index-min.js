var express=require("express"),router=express.Router(),mongoose=require("mongoose"),mongoUrl="mongodb://localhost:27017/ecommerce",User=require("../models/user_model.js");mongoose.connect(mongoUrl);var bcrypt=require("bcrypt-nodejs");router.get("/",function(e,s,o){s.render("index",{title:"Express"})}),router.post("/register",function(e,s,o){User.findOne({username:e.body.username},function(o,r){if(console.log(r),r===e.body.username)e.body.password!==e.body.password2?s.json({message:"no match",taken:"inUse"}):s.json({taken:"inUse"});else if(e.body.password!==e.body.password2)s.json({message:"no match"});else{var n=e.body.username,a=e.body.password,u=e.body.email,d=new User({username:n,password:bcrypt.hashSync(a),email:u});d.save(),s.json({message:"User Added",username:n,full_info:d})}})}),router.post("/login",function(e,s,o){User.findOne({username:e.body.username},function(o,r){if(null===r)s.json({failure:"noUser"});else{var n=bcrypt.compareSync(e.body.password,r.password);n?s.json({success:"userFound",username:r.username}):s.json({failure:"badPass"})}})}),module.exports=router;
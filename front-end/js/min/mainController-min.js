var eComApp=angular.module("ecommerceApp",["ngRoute","ngCookies"]),eController=eComApp.controller("mainController",function(e,o,n,t,a){function s(){a.get("token")&&n.get(r+"/getUserData?token="+a.get("token")).then(function e(n){console.log(n),"badToken"===n.data.failure?t.path="/login":"noToken"===n.data.failure?t.path("/login"):(o.username=n.data.username,o.loggedOut=!0)},function s(e){console.log(e)})}e.test="yo",e.userExists=!1;var r="http://localhost:3000";s(),e.frequencies=["Weekly","Bi-weekly","Monthly"],e.grinds=[{option:"Extra coarse"},{option:"Coarse"},{option:"Medium-coarse"},{option:"Medium"},{option:"Medium-fine"},{option:"Fine"},{option:"Extra fine"}],e.register=function(){console.log(e.username),n.post(r+"/register",{username:e.username,password:e.password,password2:e.password2,email:e.email}).then(function s(n){"inUse"===n.data.taken&&"no match"===n.data.message?e.errorMessage=!0:"inUse"===n.data.taken||"no match"===n.data.message?e.errorMessage=!0:e.errorMessage=!1,"inUse"===n.data.taken?e.userExists=!0:e.userExists=!1,"no match"===n.data.message?(e.noMatch=!0,console.log("passwords dont match")):e.noMatch=!1,"User Added"===n.data.message&&(o.username=n.data.username,a.put("token",n.data.token),a.put("username",e.username),o.loggedOut=!0,t.path("/options"),console.log(n.data))},function l(e){console.log(e.data)})},e.login=function(){n.post(r+"/login",{username:e.username,password:e.password}).then(function s(n){"badPass"===n.data.failure?(e.errorMessage=!0,e.noMatch=!0,console.log("bad password")):(e.errorMessage=!1,e.noMatch=!1),"userFound"===n.data.success&&(o.username=n.data.username,o.loggedOut=!0,a.put("token",n.data.token),a.put("username",e.username),t.path("/options"),console.log(n.data)),"noUser"===n.data.failure&&console.log("Incorrect password")},function l(e){console.log(e)})},e.$watch(function(){return t.path()},function(e){"/payment"===e&&console.log("hello")}),e.logout=function(){o.loggedOut=!0,a.put("token",""),a.remove("token"),a.remove("username"),console.log()},e.optionsForm=function(o){var s,l;1===o?(s="$7.00",l=e.grindTypeSolo):2===o?(s="$18.00",l=e.grindTypeFamily):(s=String(20*e.quantity),l=e.grindTypeCustom),n.post(r+"/options",{username:a.get("username"),weeklyTotal:s,grindType:l}).then(function i(e){(e.data.message="updated")&&t.path("/")},function u(e){console.log(e)})}});eComApp.config(function(e){e.when("/",{templateUrl:"views/main.html",controller:"mainController"}),e.when("/login",{templateUrl:"views/login.html",controller:"mainController"}),e.when("/register",{templateUrl:"views/register.html",controller:"mainController"}),e.when("/options",{templateUrl:"views/selection.html",controller:"mainController"}).otherwise({redirectTo:"/"})});